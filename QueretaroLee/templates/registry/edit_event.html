{% extends 'base.html' %}
{% load staticfiles %}

{% block style %}
    <link rel="stylesheet" href="{% static "style/theme.css" %}"/>
    <link rel="stylesheet" href="{% static "style/registry.css" %}"/>
{% endblock %}

{% block js %}
    <script type="text/javascript" src="{% static "js/tiny.js" %}"></script>
    <script type="text/javascript" src="{% static "js/main.js" %}"></script>

{% endblock %}

{% block head %}
    {% include 'header.html' %}
{% endblock %}

{% block main_site %}
    <div class="erase"></div>
    <div class="grid-16 edit">
    <div class="grid-14 center">
        <input type="hidden" class="entity" value="{{ entity.id }}"/>{% csrf_token %}
        <span class="title main">Editar evento
            <a href="/qro_lee/entity/{{ entity_type.1 }}/{{ entity.name|cut:" " }}_{{ entity.id }}/" class="group">{{ entity.name|capfirst }}</a>
            <span class="member grid-2">
            <span class="brown_btn fright">Editar
                <span class="sub-menu">
                    <a href="/registry/edit/{{ entity.name|cut:" " }}_{{ entity.id }}">Editar información</a>
                    <a href="">Administradores</a>
                    <a href="/registry/register_event/{{ entity_type.1 }}/{{ entity.id }}" style="border:none;" href="">Organizar eventos</a>
                    </span>
                </span>
            </span>
        </span>

        <span class="data grid-9 fleft no-margin">
            <p>Nombre {{ entity_type.0 }}
                <span class="green_btn fright">Editar</span>
                <span class="yellow_btn fright">Guardar</span>
                <span class="close right"></span>
                <input name="name" type="text" value="{{ entity.name }}" class="grid-5 alpha fright value"/>
                <span class="value grid-5 alpha fright">{{ entity.name }}</span>
            </p>
            <p class="description">Descripción
                <span class="green_btn fright">Editar</span>
                <span class="yellow_btn fright">Guardar</span>
                <span class="close right"></span>
                <textarea name="description" class="grid-5 alpha fright value">{{ entity.description }}</textarea>
                <span class="value grid-5 alpha fright">{{ entity.description|truncatewords:30 }}</span>
            </p>
            <p>Imagen de perfil
                <span class="close right"></span>
                <span class="grid-5 omega fright"></span>
            </p>
            <p>Imagen de portada
            </p>

            <p>Tipo de evento
                <span class="green_btn fright">Editar</span>
                <span class="yellow_btn fright">Guardar</span>
                <span class="close right"></span>
                <span class="value grid-5 alpha fright">
                    {% if entity.privacy_type == 0 %}
                        Públic
                    {% else %}
                        Privado
                    {% endif %}

                </span>
                <span class="select_wrapper grid-5 alpha fright">
                <span class="grid-2 select no-margin">
                            <span class="text">Publica</span>
                            <span class="dropdown"></span>
                            <select class="change value" name="privacy_type">
                                <option value="publica">Publica</option>
                                <option value="privada">Privada</option>
                            </select>
                </span>
                </span>

            </p>
            <p>Fecha creación
                <span style="visibility: hidden;" class="green_btn fright">Editar</span>
                <span class="value grid-5 alpha fright">{{ entity.date|date:"d \d\e M \d\e\l Y" }}</span>
            </p>
            <p>Lugar del evento
                <span class="green_btn fright">Editar</span>
                <span class="yellow_btn fright">Guardar</span>
                <span class="close right"></span>
                <textarea name="address" class="map address value">{{ entity.address }}</textarea>
                <span class="value map">{{ entity.address }}</span>
                <span id="map" class="grid-5 alpha fright"></span>
            </p>
        </span>
        <span style="border:none;" class="data grid-9 fleft no-margin">
            <p>¿Deseas conectar tu cuenta de Facebook y Twitter?</p>

        </span>
    </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function(){
            initialize();
            $('.green_btn').click(function(){
                $this = $(this);
                $(this).parent().find('span.value').fadeOut(300,
                function(){
                    if($this.parent().find('input.value').length > 0){
                        $this.parent().find('input.value').fadeIn(300,function(){
                            $this.parent().find('span.green_btn').fadeOut(300,
                            function(){
                                 $this.parent().find('span.yellow_btn').fadeIn(300,function(){
                                     $this.parent().find('.close').fadeIn(300);
                                 });
                            });

                        });
                    }else if($this.parent().find('textarea.value').length > 0){
                        $this.parent().find('textarea.value').fadeIn(300,function(){
                            $this.parent().find('span.green_btn').fadeOut(300,
                            function(){
                                 $this.parent().find('span.yellow_btn').fadeIn(300,function(){
                                     $this.parent().find('.close').fadeIn(300);
                                 });
                            });

                        });
                    }else{
                        $this.parent().find('.select_wrapper').fadeIn(300,function(){
                            $this.parent().find('span.green_btn').fadeOut(300,
                            function(){
                                 $this.parent().find('span.yellow_btn').fadeIn(300,function(){
                                     $this.parent().find('.close').fadeIn(300);

                                 });
                            });

                        });
                    }
                });

            });
            $('.close').click(function(){
                $this = $(this);
                $(this).fadeOut(300,
                    function(){
                        $this.parent().find('span.yellow_btn').fadeOut(300,function(){
                            $this.parent().find('span.green_btn').fadeIn(300,
                            function(){
                                if($this.parent().find('input.value').length > 0){
                                 $this.parent().find('input.value').fadeOut(300,function(){
                                     $this.parent().find('span.value').fadeIn(300);
                                 });
                                }else if($this.parent().find('textarea.value').length > 0){
                                    $this.parent().find('textarea.value').fadeOut(300,function(){
                                        $this.parent().find('span.value').fadeIn(300);
                                    });
                                }else{
                                    $this.parent().find('.select_wrapper').fadeOut(300,function(){
                                        $this.parent().find('span.value').fadeIn(300);
                                    });
                                }
                            });

                        });
                });
            });
            $('.yellow_btn').click(function(){
                var field = $(this).parent().find('input.value').attr('name');
                var value = $(this).parent().find('input.value').val();
                if($(this).parent().find('textarea.value').length > 0){
                    value = $(this).parent().find('textarea.value').val();
                    field = $(this).parent().find('textarea.value').attr('name');
                }else if($(this).parent().find('.select_wrapper').length > 0){
                    value = $(this).parent().find('select.value').val();
                    field = $(this).parent().find('select.value').attr('name');
                }
                $this = $(this);
                $.ajax({
                type: "POST",
                url: '/registry/update/'+$('input.entity').val()+'/',
                data: {
                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                    'field': field,
                    'value': value,
                    'event': 1
                },
                dataType: 'json'
                }).done(function(data){
                    if($this.parent().find('input.value').length > 0)
                        $this.parent().find('span.value').html($this.parent().find('input.value').val());
                    else if($this.parent().find('textarea.value').length > 0)
                        $this.parent().find('span.value').html($this.parent().find('textarea.value').val());
                    else
                        $this.parent().find('span.value').html($this.parent().find('select.value').val());
                    $this.parent().find('.close').fadeOut(300,function(){
                    $this.fadeOut(300,function(){
                            $this.parent().find('span.green_btn').fadeIn(300,
                            function(){
                                if($this.parent().find('input.value').length > 0){
                                 $this.parent().find('input.value').fadeOut(300,function(){
                                     $this.parent().find('span.value').fadeIn(300);
                                 });
                                }else if($this.parent().find('textarea.value').length > 0){
                                    $this.parent().find('textarea.value').fadeOut(300,function(){
                                     $this.parent().find('span.value').fadeIn(300);
                                 });
                                }else{
                                    $this.parent().find('.select_wrapper').fadeOut(300,function(){
                                     $this.parent().find('span.value').fadeIn(300);
                                 });
                                }
                            });

                        });
                    });
                });
            });
        });
    </script>
{% endblock %}