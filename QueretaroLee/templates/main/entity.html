{% extends 'base.html' %}
{% load staticfiles %}
{% load registry_tags %}

{% block style %}
    <link rel="stylesheet" href="{% static "style/theme.css" %}"/>

{% endblock %}

{% block js %}
    <script type="text/javascript" src="{% static "js/tiny.js" %}"></script>
    <script type="text/javascript" src="{% static "js/main.js" %}"></script>
    <script type="text/javascript" src="{% static "js/ajax.js" %}"></script>
    <script type="text/javascript" src="{% static "js/validation.js" %}"></script>

{% endblock %}


{% block head %}
    {% include 'header.html' %}
{% endblock %}

{% block main_site %}
    <div class="wrapper_message " >
        <div class="container-16 container_message">
            <div class="alert-message gray">{% csrf_token %}
                <p>Para poder ser miembro, tu solicitud será enviada al
                    administrador del group</p>
                <form class="no_ajax fleft" action="/qro_lee/entity/{{ entity_type.1 }}/entity_{{ entity.id }}/" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="follow_private" value="1"/>
                    <input type="submit" class="accept green_btn" value="Acceptar">
                </form>
                <span class="reject fleft">Rechazar</span>
                <input class="user" type="hidden"/>
                <input class="entity" value="{{ entity.id }}" type="hidden"/>
            </div>
        </div>
    </div>
<div class="grid-16">
<input type="hidden" class="d-entity_id" value="entity_{{ entity.id }}"/>
<input type="hidden" class="type" value="{{ entity.type }}"/>
<input type="hidden" class="lat" value="{{ entity.lat }}"/>
<input type="hidden" class="long" value="{{ entity.long }}"/>
    <div class="grid-16 entity no-margin">
        {% if owner.id != user.id %}

            {% if entity_type.1 == 'spot' %}
                <span class="member grid-2">
                    <span class="btn ">Seguir</span>
                </span>
            {% endif %}
            {% if entity_type.1 == 'group' %}
                <span class="member grid-3">
                <span class="grid-2 no-margin fright">
                    {% if member and entity.privacy == 0 %}
                    <form class="no_ajax fleft" action="/qro_lee/entity/{{ entity_type.1 }}/entity_{{ entity.id }}/" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="membership" value="-1"/>
                        <input type="submit" class="btn " value="Salir">
                    </form>
                    <p class="din-r followers fleft">{{ followers|total_members }} miembros</p>
                {% elif member and entity.privacy != 0 %}

                    <form class="no_ajax fleft" action="/qro_lee/entity/{{ entity_type.1 }}/entity_{{ entity.id }}/" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="follow_private" value="-1"/>
                            <input type="submit" class="btn" value="Salir">
                        </form>
                        <p class="din-r followers fleft">{{ followers|total_members }} miembros</p>
                {% else %}

                    {% if entity.privacy == 1 %}
                        <span class="btn no-ajax fleft">Seguir</span>
                        <p class="din-r followers fleft">{{ followers|total_members }} miembros</p>
                        <p class="private-icon fright">
                            <img src="/static/img/private_icon.png" alt=""/><span class="fright">Organizacion <br> Privada</span>
                        </p>
                    {% else %}
                        <form class="no_ajax fleft" action="/qro_lee/entity/{{ entity_type.1 }}/entity_{{ entity.id }}/" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="membership" value="1"/>
                            <input type="submit" class="btn " value="Seguir">
                        </form>
                        <p class="din-r followers fleft">{{ followers|total_members }} miembros</p>
                    {% endif %}
                {% endif %}
                </span>
                </span>
            {% endif %}

            {% if entity_type.1 == 'organization' %}
                <span class="member grid-6 no-margin">
                <span class="grid-2 no-margin fright">

                {% if member and entity.privacy == 0 %}
                    <form class="no_ajax fleft" action="/qro_lee/entity/{{ entity_type.1 }}/entity_{{ entity.id }}/" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="membership" value="-1"/>
                        <input type="submit" class="btn " value="Salir">
                    </form>
                    <p class="din-r followers fleft">{{ followers|total_members }} miembros</p>
                {% elif member and entity.privacy != 0 %}

                    <form class="no_ajax fleft" action="/qro_lee/entity/{{ entity_type.1 }}/entity_{{ entity.id }}/" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="follow_private" value="-1"/>
                            <input type="submit" class="btn" value="Salir">
                        </form>
                    <p class="din-r followers fleft">{{ followers|total_members }} miembros</p>
                {% else %}

                    {% if entity.privacy != 0 %}
                        <span class="btn no-ajax fleft">Seguir</span>
                        <p class="din-r followers fleft">{{ followers|total_members }} miembros</p>
                        <p class="private-icon fright">
                            <img src="/static/img/private_icon.png" alt=""/><span class="fright">Organizacion <br> Privada</span>
                        </p>

                    {% else %}
                        <p class="follow no-margin">Para recibir notificaciones sobre eventos y
                        actividades referente a {{ entity.name }}, da click en el botón</p>
                        <form class="no_ajax fleft" action="/qro_lee/entity/{{ entity_type.1 }}/entity_{{ entity.id }}/" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="membership" value="1"/>
                            <input type="submit" class="btn " value="Seguir">
                        </form>
                        <p class="din-r followers fleft">{{ followers|total_members }} miembros</p>
                        <span class="followers">
                        <p>Usarios siguiendo</p>
                        {% for follower, profile in followers %}
                            <span>
                                {% if not profile.picture or profile.picture == '' %}
                                    <img src="/static/img/create.png" alt=""/>
                                {% else %}
                                    <img src="/static/media/users/{{ follower.id }}/profile/{{ profile.picture }}" alt=""/>
                                {% endif %}
                                <span class="user">
                                    {% if follower.first_name != '' %}
                                        {{ follower.first_name }} {{ follower.last_name }}
                                    {% else %}
                                        {{ follower.username }}
                                    {% endif %}
                                </span>
                            </span>

                        {% endfor %}
                    </span>
                    {% endif %}

                {% endif %}

                </span>
                </span>
            {% endif %}

        {% else %}
            {% block entity_menu %}
                {% include 'blocks/entity_menu.html' %}
            {% endblock %}
        {% endif %}
        <span class="wrapper fleft">
            {% if entity.picture == '' %}
                <img src="/static/img/create.png" alt="{{ entity.name }}"/>
            {% else %}
                {% if owner.id == user.id %}
                    <span class="brown_btn edit"></span>
                {% endif %}
                <img src="/static/media/users/{{ owner.id }}/entity/{{ entity.picture }}" alt="{{ entity.name }}"/>
            {% endif %}

        </span>
        <span class="general-info no-margin grid-7">
            <h3 class="title {{ entity_type.1 }}">{{ entity.name|capfirst }}</h3>
            <span class="social grid-7 no-margin">
                {% if entity.fb != '' %}
                <a href="https://facebook.com/{{ entity.fb }}" target="_blank">
                    {% if entity_type.1 == 'group' %}
                        <img src="/static/img/single_fb.png" alt=""/>
                    {% elif entity_type.1 == 'spot' %}
                        <img src="/static/img/ssingle_fb.png" alt=""/>
                    {% else %}
                        <img src="/static/img/gsingle_fb.png" alt=""/>
                    {% endif %}
                </a> <img src="{% static "img/social_divider.png" %}" alt=""/>
                {% endif %}
                {% if entity.twitter != '' %}
                <a href="http://twitter.com/{{ entity.twitter }}" target="_blank">
                    {% if entity_type.1 == 'group' %}
                        <img src="/static/img/single_twitter.png" alt=""/>
                    {% elif entity_type.1 == 'spot' %}
                        <img src="/static/img/ssingle_twitter.png" alt=""/>
                    {% else %}
                        <img src="/static/img/gsingle_twitter.png" alt=""/>
                    {% endif %}
                </a> <img src="{% static "img/social_divider.png" %}" alt=""/>
                {% endif %}
                {% if entity.website != '' %}
                <a href="{{ entity.website }}" target="_blank">
                    {% if entity_type.1 == 'group' %}
                        <img src="/static/img/single_world.png" alt=""/>
                    {% elif entity_type.1 == 'spot' %}
                        <img src="/static/img/ssingle_world.png" alt=""/>
                    {% else %}
                        <img src="/static/img/gsingle_world.png" alt=""/>
                    {% endif %}
                </a>
                {% endif %}
            </span>
            {% if entity_type.1 != 'group' %}
                <span class="grid-7 no-margin container_rate">
                    <span class="container_starts_rate fleft">
                    {% if grade == 0 %}
                            {% for x in range %}
                                <span class="rate">
                                    {% if x < grade_rate %}
                                        <img src="/static/img/comunityStar.png" />
                                    {% else %}
                                        <img src="/static/img/backgroundStar.png" />
                                    {% endif %}
                                    <input class="grade" type="hidden" value="{{ x }}"/>
                                    <input class="type" type="hidden" value="E"/>
                                    <input class="element_id" type="hidden" value="{{ entity.id }}"/>
                                </span>
                            {% endfor %}
                    {% else %}
                        {% for x in range %}
                            {% if x < grade %}
                                <img src="/static/img/starUser.png" />
                            {% else %}
                                <img src="/static/img/backgroundStar.png" />
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                </span>
                <span class="container_text_rate">
                    <span class="text_rate border_right"> Total: {{ count_grade|floatformat:1 }} </span>
                    <span class="text_rate border_right"> {{ count }} votaciones </span>
                        {% if grade >= 1 %}
                            <span class="text_rate"> mi voto: {{ grade }} </span>
                        {% endif %}
                    </span>
               </span>
            {% endif %}
            {% if entity_type.1 == 'group' %}
                <p class="din-r grid-6 alpha omega desc_group">
                    {{ entity.description|truncatewords:30 }}
                </p>
            {% else %}
                <p class="din-r grid-6 alpha omega">
                    {{ entity.description|truncatewords:30 }}
                </p>
            {% endif %}
        </span>
        <span class="nav {{ entity_type.1 }} grid-8 no-margin">
            <span class="btn">Actividad</span>
            <span class="btn">Información General</span>
            <span class="btn">Eventos</span>
            {% if entity_type.1  == 'group' %}
            <span class="btn">Miembros</span>
            {% endif %}
        </span>

    </div>

    <div class="grid-16 content single no-margin">
        <div class="grid-16 load no-margin" style="display: block">
            {% if entity.privacy == 0 %}
            <div class="coments grid-10 no-margin">
                {% load disqus_tags %}
                {% set_disqus_identifier entity_type entity.id %}
                {% disqus_show_comments %}
                <div class="titles_author grid-5 border_left">
                {% if type == 'author' %}
                    <div class="container_titles grid-5 no-margin border_bottom">
                        <h3 class="title my_titles">
                            Titulos de este autor
                        </h3>
                        {% for title in list_titles %}
                            <span class="item_title grid-5 no-margin">
                                <a href="/qro_lee/profile/title/title_{{ title.id }}">
                                    <span class="wrapper_title borde_author ">
                                        <img src="/static/media/author/create.png" />
                                    </span>
                                </a>
                                <a href="/qro_lee/profile/title/{{ title.title|cut:" " }}_{{ title.id }}">
                                    <h3 class="title grid-3 title_mini">
                                        {{ title.title|truncatechars:25 }}
                                    </h3>
                                </a>
                            </span>
                        {% endfor %}
                        <span class="place_pink link_all fright all_book">ver todos</span>
                    </div>
                    <div class="container_titles grid-5 no-margin ">
                        <h3 class="title my_titles">
                            Lista que contiene este autor
                        </h3>
                        {% for obj in list %}
                            <span class="item_title grid-5 no-margin">
                                <span class="wrapper_title borde_author ">
                                    <img src="/static/media/author/create.png" />
                                </span>
                                <h3 class="title grid-3 title_mini">
                                   {{ obj.list.name|truncatechars:25 }}
                                </h3>
                                <p class="grid-3 p_text_mini text_list">Lista creada por
                                    <span class="d-pink">{{ obj.list.user.first_name }} </span>
                                </p>
                            </span>
                        {% endfor %}
                        <span class="place_pink link_all fright all_book">ver todos</span>
                    </div>
                {% endif %}
                {% if type == 'title' %}
                    <div class="container_titles grid-5 no-margin border_bottom">
                        <h3 class="title my_titles">
                            Personas que han leído este libro
                        </h3>
                        {% for obj in list_user %}
                            <span class="item_title grid-5 no-margin">
                                <span class="wrapper_title borde_author ">
                                    <img src="/static/media/users/{{ obj.list.user.id }}/profile/create.jpg" />
                                </span>
                                <h3 class="title grid-3 title_mini text_name_user">
                                   {{ obj.list.user.first_name|truncatechars:12 }} {{ obj.list.user.last_name|truncatechars:12 }}
                                </h3>
                            </span>
                        {% endfor %}
                        <span class="place_pink link_all fright all_book">ver todos</span>
                    </div>
                    <div class="container_titles grid-5 no-margin ">
                        <h3 class="title my_titles">
                            Lista que contienen este libro
                        </h3>
                        {% for obj in list %}
                            <span class="item_title grid-5 no-margin">
                                <span class="wrapper_title borde_author ">
                                    <img src="/static/media/author/create.png" />
                                </span>
                                <h3 class="title grid-3 title_mini">
                                   {{ obj.list.name|truncatechars:25 }}
                                </h3>
                                <p class="grid-3 p_text_mini text_list">Lista creada por
                                    <span class="d-pink">{{ obj.list.user.first_name }} </span>
                                </p>
                            </span>
                        {% endfor %}
                        <span class="place_pink link_all fright all_book">ver todos</span>
                    </div>
                {% endif %}
            </div>
            </div>
            {% else %}
                <p class="private-message margin-50 center">Este grupo es privado,
                    <br> para ver la información solicitada
                    <br>necesitas ser miembro</p>
            {% endif %}
        </div>

    {% if entity_type.1 == 'spot' %}
        <div class="grid-16 spot load no-margin">
    {% else %}
        <div class="grid-16 load no-margin">
    {% endif %}
            {% if entity.privacy == 0 %}
            <div class="sidebar-a grid-11">
            <h3 class="title main">Información General</h3>
            <span class="cover-picture wrapper">
                {% if entity_type.1 == 'group' %}
                    {% if not entity.cover_picture %}
                        <img src="/static/img/create.png" alt="{{ entity.name }}"/>
                    {% else %}
                        <img src="/static/media/users/{{ owner.id }}/entity/{{ entity.cover_picture }}" alt="{{ entity.name }}"/>
                    {% endif %}
                {% endif %}
                {% if entity_type.1 == 'organization' or entity_type.1 == 'spot' %}
                    <span id="map" {% ifequal entity_type.1 "spot"%}class='spot'{% endifequal %}>

                    </span>
                {% endif %}
            </span>

            {% if entity_type.1 == 'spot' %}
                <div class="grid-3 contact omega">
                <span class="ruler"></span>
                    <span class="contact">
                        <h3 class="title main">Ubicacion</h3>
                        <p>
                            {% if entity.address.0 != '' %}
                                {{ entity.address.0 }} <br>
                                {{ entity.address.1 }}
                            {% else %}
                                Querétaro
                            {% endif %}
                        </p>
                        <h3 style="margin-top: 20px" class="title main fleft">Contacto</h3>
                        <p>{{ profile.phone }}</p>
                    </span>
                </div>
            {% endif %}

            {% if entity_type.1 == 'organization' %}
                <div class="grid-7 no-margin">
                <span class="ruler"></span>
            {% endif %}

            {% if entity_type.1 == 'spot' %}
                <div style="padding: 0px 40px 0px 40px;" class="overvieww no-margin fright grid-6 content">
                    <span class="ruler"></span>
                    <p >{{ entity.description }}</p>
                </div>

            {% else %}
                <div class="overvieww content">
                    <p style="width:90%;margin:0 auto !important;">{{ entity.description }}</p>
                </div>
            {% endif %}

            {% if entity_type.1 == 'organization' %}
            </div>

            {% endif %}

            {% if entity_type.1 == 'organization' %}
                <div class="grid-4 contact fright no-margin">
                <span class="ruler"></span>
                    <span class="contact">
                        <h3 class="title main">Contacto</h3>

                        <p>{{ owner.email }}</p>
                        <p>{{ profile.phone }}</p>
                        <p>{{ entity.website }}</p>
                        <h3 style="margin-top: 20px;" class="title fleft main">Ubicación</h3>
                        <p>{{ entity.address.0 }} <br>
                        <span>{{ entity.address.1 }}</span></p>
                    </span>
                </div>
            {% endif %}


            {% if entity_type.1 == 'group' %}
                <div class="more-info">
                    <span class="grid-3 alpha">
                    <h3 class="title main">Miembros <span>{{ followers|total_members }}</span></h3>
                    </span>
                    <span class="grid-4">
                        <h3 class="title main">Contacto <span>{{ owner.email }}</span></h3>
                    </span>
                    <span class="grid-3 omega">
                        <h3 class="title main">Administrador/es
                            <span>{{ owner.first_name }}</span>
                            {% for admin in admins %}
                                {% if admin.first_name == '' %}
                                    <span>{{ admin.username }}</span>
                                {% else %}
                                    <span>{{ admin.first_name }}</span>
                                {% endif %}
                            {% endfor %}
                        </h3>
                    </span>
                </div>
            {% endif %}
            </div>
            <div class="grid-4 sidebar-b">
                <h3 class="title grid-4">{{ entity_type.0|capfirst }} similares</h3>
                <div id="scrollbar1">
                    <div style="width: 5px;" class="scrollbar"><div class="track"><div class="thumb" style="width: 5px;"><div class="end"></div></div></div></div>
                    <div class="viewport" style="height:360px;">
                        <div class="overview" style="border:none;height:auto;">
                        {% for similar_entity, followers in similar_entities %}
                        <span class="wrapper">
                            <span class="fleft">
                                <img src="/static/media/users/{{ similar_entity.user_id }}/entity/{{ similar_entity.picture }}" alt=""/>
                            </span>
                            <a href="/qro_lee/entity/{{ entity_type.1 }}/{{ similar_entity.name|cut:" " }}_{{ similar_entity.id }}">
                                <h3 class="title fleft">{{ similar_entity.name }}
                                    {% if entity_type.1 == 'spot' %}
                                        <span class="view">Ver spot</span>
                                    {% else %}

                                        <span> {{ followers }} miembro{{ followers|pluralize }}</span>
                                    {% endif %}
                                </h3>
                            </a>
                        </span>
                        {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
                <p class="private-message margin-50 center">Este grupo es privado,
                    <br> para ver la información solicitada
                    <br>necesitas ser miembro</p>
            {% endif %}
        </div>
        <div class="grid-16 load no-margin">
        {% if entity.privacy == 0 %}
            <div class="sidebar-a grid-10">
                <h3 class="title main">Próximos eventos</h3>
                <span class="month">Septiembre</span>
                <div id="scrollbar1">
                    <div  class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>
                    <div class="viewport">
                        <div class="overview">
                            <span class="item">
                                <span class="no-margin grid-6">
                                    <span class="date fright din-m"></span>
                                    <span class="ruler grid-4 fright"></span>

                                </span>
                                <span class="wrapper fleft">
                                    <img class="profile-picture img_size_all" src="" alt=""/>
                                </span>
                                <span class="general-info fleft">
                                    <h3 class="title"></h3>
                                    <p>
                                        <span class="info grid-7 alpha"></span>

                                    </p>
                                    <span class="time fleft"></span>
                                    <span class="location fright">
                                        <p>
                                            <span class="place"></span><br>
                                            <span></span>
                                        </p>
                                        <span class="apply fright">asistir</span>
                                    </span>
                                </span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="grid-4 sidebar-b d-margin_calendar fleft">
            <h3 class="title">Calendario</h3>
            <input class="entity" type="hidden" value="{{ entity.id }}"/>{% csrf_token %}
                <div class="overview">
                    {% autoescape off %}
                        {{ calendar }}
                    {% endautoescape %}
                </div>
                <div class="controller center">
                    <span class="prev fleft"><</span>
                    <span class="next fright">></span>
                </div>
            </div>
        </div>
        {% else %}
                <p class="private-message margin-50 center">Este grupo es privado,
                    <br> para ver la información solicitada
                    <br>necesitas ser miembro</p>
            {% endif %}
        {% if entity_type.1 == 'group' %}
        <div class="grid-15 offset-1 members load no-margin">
            <div id="scrollbar1 ">
                    <div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>
                    <div class="viewport">
                        <div class="overview">
                            {% for follower, profile in followers %}
                                <span class="wrapper grid-5 no-margin">
                                    <span class="fleft">
                                        {% if not profile.picture or profile.picture == '' %}
                                            <img src="/static/img/create.png" alt=""/>
                                        {% else %}
                                            <img src="/static/media/users/{{ follower.id }}/profile/{{ profile.picture }}" alt=""/>
                                        {% endif %}
                                    </span>
                                    <h3 class="title fleft">
                                        {% if follower.first_name != '' %}
                                        {{ follower.first_name }} {{ follower.last_name }}
                                        {% else %}
                                            {{ follower.username }}
                                        {% endif %}
                                        <span class="fleft">Se unio hace
                                            {{ follower.date_joined|member_since }}
                                        </span>
                                        <a class="fleft spot din-r" href="/accounts/users/profile/{{ follower.id }}">Ver perfil</a>
                                    </h3>
                                </span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
        </div>
        {% endif %}
    </div>

</div>
{% endblock %}